# Makefile for Inception-of-Things - Part 2

GREEN   = \033[32;1m
YELLOW  = \033[33;1m
BLUE    = \033[34;1m
CYAN    = \033[36;1m
MAGENTA = \033[35;1m
RED     = \033[31;1m
RESET   = \033[0m

.PHONY: all up deploy clean test help

all: up deploy

up:
	@echo "$(BLUE)üöÄ Vagrant sanal makinesi ba≈ülatiliyor...$(RESET)"
	@vagrant up

# uygulama dagitma
deploy:
	@echo "$(GREEN)üåê Kubernetes uygulamalari daƒüƒ±tƒ±lƒ±yor...$(RESET)"
	@vagrant ssh -c "kubectl apply -f /vagrant/configs/app1.yaml"
	@vagrant ssh -c "kubectl apply -f /vagrant/configs/app2.yaml"
	@vagrant ssh -c "kubectl apply -f /vagrant/configs/app3.yaml"
	@vagrant ssh -c "kubectl apply -f /vagrant/configs/ingress.yaml"

# uygulamalari ve vm`i sil
clean:
	@echo "$(RED)üßπ Kubernetes kaynaklari siliniyor...$(RESET)"
	@vagrant ssh -c "kubectl delete -f /vagrant/configs/app1.yaml" || true
	@vagrant ssh -c "kubectl delete -f /vagrant/configs/app2.yaml" || true
	@vagrant ssh -c "kubectl delete -f /vagrant/configs/app3.yaml" || true
	@vagrant ssh -c "kubectl delete -f /vagrant/configs/ingress.yaml" || true
	@echo "$(RED)üóëÔ∏è  Sanal makine siliniyor...$(RESET)"
	@vagrant destroy -f
	@rm -rf .vagrant

# curl ile uygulama kontrolu
test:
	@echo "$(MAGENTA)üîç Uygulamalar test ediliyor...$(RESET)"
	@echo "$(CYAN)--> üåê app1.com$(RESET)"
	@curl -H "Host: app1.com" 192.168.56.110
	@echo ""
	@echo "$(CYAN)--> üåê app2.com$(RESET)"
	@curl -H "Host: app2.com" 192.168.56.110
	@echo ""
	@echo "$(CYAN)--> üåê Varsayilan (app3)$(RESET)"
	@curl 192.168.56.110

kill-kvm: # √ßakƒ±≈üma problemi oluyor arada. bu sorunu √ß√∂z√ºyor.
	sudo rmmod kvm_amd
	sudo rmmod kvm

help:
	@echo "$(GREEN)üìò Kullanilabilir Makefile Komutlari:$(RESET)"
	@echo "  $(YELLOW)‚ñ∂ make up     $(RESET) - $(CYAN)Vagrant ortamini ve K3s k√ºmesini ba≈ülatir.$(RESET)"
	@echo "  $(YELLOW)‚ñ∂ make deploy $(RESET) - $(CYAN)Uygulamalari Kubernetes √ºzerine deploy eder.$(RESET)"
	@echo "  $(YELLOW)‚ñ∂ make clean  $(RESET) - $(CYAN)T√ºm VM'leri ve Kubernetes kaynaklarini siler.$(RESET)"
	@echo "  $(YELLOW)‚ñ∂ make test   $(RESET) - $(CYAN)Uygulama endpoint'lerini test eder.$(RESET)"
	@echo "  $(YELLOW)‚ñ∂ make help   $(RESET) - $(CYAN)Bu yardim men√ºs√ºn√º g√∂sterir.$(RESET)"

