# Bu dosya, GitLab'in kaynak kullanımını önemli ölçüde azaltır.
global:
  # NİHAİ DÜZELTME 1: GitLab'e, kendi Nginx'ini kurmak yerine
  # cluster'daki mevcut Traefik Ingress Controller'ı kullanmasını söylüyoruz.
  ingress:
    configureCertmanager: false
    # Modern Kubernetes sürümleri için 'class' yerine bu kullanılır.
    ingressClassName: traefik

  # NİHAİ DÜZELTME 2: Alan adını doğru ayarlıyoruz.
  hosts:
    domain: gitlab.local
    # External IP'yi boş bırakarak K3d'nin Load Balancer'ının işini yapmasına izin veriyoruz.
    externalIP: ""

  # Kaynakları azaltmak için gereksiz servisleri kapatıyoruz.
  kas:
    enabled: false
  pages:
    enabled: false
  email:
    enabled: false

# GitLab'in ana bileşenlerinin kaynak taleplerini düşürüyoruz.
gitlab:
  webservice:
    # Webservice'in pod içindeki 'workhorse' ile konuşabilmesi için localhost'u dinlemesini sağlıyoruz.
    extraEnv:
      GITLAB_WEBSERVICE_LISTEN_ADDR: "0.0.0.0"
    resources:
      requests:
        cpu: 100m
        memory: 1.8G
  sidekiq:
    resources:
      requests:
        cpu: 100m
        memory: 1G
  gitaly:
    resources:
      requests:
        cpu: 100m
        memory: 500M
  gitlab-shell:
    resources:
      requests:
        cpu: 50m
        memory: 100M

# NİHAİ DÜZELTME 3: GitLab'in kendi Ingress Controller'ını kurmasını engelliyoruz.
nginx-ingress:
  enabled: false

# Diğer servislerin kaynak taleplerini düşürüyoruz.
registry:
  resources:
    requests:
      cpu: 50m
      memory: 100M
minio:
  resources:
    requests:
      cpu: 50m
      memory: 150M
postgresql:
  image:
    tag: 16.7.0-debian-12-r27
  resources:
    requests:
      cpu: 100m
      memory: 512M
redis:
  resources:
    requests:
      cpu: 100m
      memory: 300M

